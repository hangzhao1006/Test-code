# 🤖 自动记录功能说明

## 功能概述

现在系统会自动记录用户的皮肤状况，包括：
1. **图片分析记录** - 上传照片分析时自动保存
2. **对话记录** - 聊天中提到皮肤问题时自动保存

所有记录会显示在右侧边栏的"皮肤状况记录"区域。

---

## 自动记录触发条件

### 1. 图片分析 📷

当用户上传照片进行皮肤分析时：
- ✅ 自动保存用户的描述（如果有）
- ✅ 保存AI分析结果摘要
- ✅ 标记为"照片"记录
- ✅ 包含肤质、问题等关键信息

### 2. 聊天对话 💬

当用户在聊天中提到以下关键词时自动记录：

**中文关键词**:
- 皮肤、肤质、干燥、油腻、痘痘
- 粉刺、敏感、红肿、暗沉、毛孔

**英文关键词**:
- skin, dry, oily, acne, sensitive

---

## 记录显示

### 标签系统

每条记录会显示不同的标签：

- **📷 照片** - 蓝色标签，表示包含图片分析
- **🤖 AI分析** - 绿色标签，表示有AI分析结果

### 显示内容

1. **日期** - 记录时间
2. **用户描述** - 用户输入的内容
3. **AI分析摘要** (如果有):
   - 肤质类型
   - 主要问题（最多2个）
4. **天气信息** (如果有):
   - 温度
   - 天气描述

---

## 数据存储

### LocalStorage位置

- `skinConditions` - 手动保存的记录
- `skinAnalysisHistory` - 自动保存的分析记录

### 数据结构

```javascript
{
  id: 1699999999999,                    // 时间戳ID
  date: "2025-11-13T10:30:00.000Z",    // ISO日期
  condition: "今天皮肤有点干燥",        // 用户描述
  hasImage: true,                       // 是否有照片
  imagePreview: "data:image...",        // 图片预览（前100字符）
  analysis: {                           // AI分析结果
    skinType: "干性",                   // 肤质类型
    concerns: ["干燥", "细纹"],        // 主要问题
    summary: "..."                      // 分析摘要（前200字符）
  }
}
```

### 存储限制

- 最多保留 **20条** 最近记录
- 自动按日期排序（最新的在前）

---

## 实时更新

### 事件系统

当有新记录保存时：
1. 触发自定义事件 `skinConditionUpdated`
2. 右侧边栏自动刷新显示
3. 无需手动刷新页面

### 数据同步

- 主页面（page.jsx）保存记录
- 侧边栏（WeatherCalendar.jsx）实时显示
- 通过事件监听保持同步

---

## 用户操作

### 删除记录

点击每条记录右上角的 **×** 按钮可删除该记录

删除操作会：
- ✅ 从显示列表移除
- ✅ 从localStorage移除
- ✅ 同时清理两个存储位置

### 手动添加记录

用户仍然可以通过输入框手动添加记录：
1. 在"皮肤状况记录"卡片的输入框输入
2. 点击"💾 保存记录"按钮
3. 记录会保存到 `skinConditions`

---

## 示例场景

### 场景1: 上传照片分析

```
用户: 上传照片 + "最近皮肤有点干燥和细纹"
系统: 
  1. GPT-4 Vision分析照片
  2. 自动保存记录:
     - 描述: "最近皮肤有点干燥和细纹"
     - 标签: 📷 照片, 🤖 AI分析
     - 肤质: 干性
     - 问题: 干燥、细纹
  3. 右侧边栏实时显示
```

### 场景2: 聊天咨询

```
用户: "我的皮肤很干燥，推荐什么保湿霜？"
系统:
  1. AI回复护肤建议
  2. 检测到关键词"皮肤"、"干燥"
  3. 自动保存记录:
     - 描述: "我的皮肤很干燥，推荐什么保湿霜？"
     - 无标签（纯文字记录）
  4. 右侧边栏实时显示
```

### 场景3: 查看历史

用户可以在右侧边栏查看：
- 所有记录按时间排序
- 带照片的记录有蓝色标签
- 带AI分析的记录有绿色标签
- 显示肤质和主要问题

---

## 技术实现

### 关键函数

1. **autoSaveSkinCondition()** - 自动保存函数
   - 位置: `page.jsx`
   - 参数: condition, analysisResult, imageData
   - 触发事件通知侧边栏

2. **loadSavedConditions()** - 加载记录
   - 位置: `WeatherCalendar.jsx`
   - 合并两个存储位置的数据
   - 按日期排序

3. **deleteSkinCondition()** - 删除记录
   - 位置: `WeatherCalendar.jsx`
   - 从两个位置同时删除

### 触发位置

- `handleImageAnalysis()` - 图片分析后
- `handleChat()` - 聊天消息后（如果包含皮肤关键词）

---

## 优势

1. **自动化** - 无需手动记录，自动追踪皮肤状况
2. **智能化** - 只记录皮肤相关的对话
3. **可视化** - 清晰的标签和摘要显示
4. **历史追踪** - 可查看历史记录，了解皮肤变化趋势
5. **数据丰富** - 包含AI分析、天气等多维度信息

---

**更新日期**: 2025-11-13
**版本**: v1.1.0
